传输层通信：

> 世界上不存在完全可靠的通信协议

> 两军问题

TCP:传输控制协议(Transmission Control Protocol),面向连接的协议，双向通信协议，即通信双方都有能力发送消息，并接收响应

UDP:用户数据报协议(User Datagram Protocol),无连接的协议，报文发送之后，无法得知其是否安全完整到达




默认发送方为客户端Client，被动服务端Server；

例：

一次通信：如公告


## TCP
> 三次握手建立连接——数据传输——四次挥手断开连接

#### 三次握手(three-way handshake）

为什么是三次握手？

相对可靠

C发送请求给S(第一步握手),C不确定S是否同意，

S发送回答给C(第二步握手),同样S不确定C是否知道S已经同意，

C再次发送确认已知晓S的同意(第三步握手),S收到后建立连接。


二次握手，无法确定C发送的有效性，可能接收到其他已失效的请求，浪费服务端连接资源


##### 第一次握手：

客户端Client向服务端Server发送连接请求报文段。该报文段的头部中SYN=1，ACK=0，seq=x。请求发送后，客户端便进入SYN-SENT状态。

PS1：SYN=1，ACK=0表示该报文段为连接请求报文。

PS2：x为本次TCP通信的字节流的初始序号。

TCP规定：SYN=1的报文段不能有数据部分，但要消耗掉一个序号



##### 第二次握手

服务端收到连接请求报文段后，如果同意连接，则会发送一个应答：SYN=1，ACK=1，seq=y，ack=x+1。

该应答发送完成后便进入SYN-RCVD状态。

PS1：SYN=1，ACK=1表示该报文段为连接同意的应答报文。

PS2：seq=y表示服务端作为发送者时，发送字节流的初始序号。

PS3：ack=x+1表示服务端希望下一个数据报发送序号从x+1开始的字节


##### 第三次握手

当客户端收到连接同意的应答后，还要向服务端发送一个确认报文段，表示：服务端发来的连接同意应答已经成功收到。

该报文段的头部为：ACK=1，seq=x+1，ack=y+1。

客户端发完这个报文段后便进入ESTABLISHED状态，服务端收到这个应答后也进入ESTABLISHED状态，此时连接的建立完成


#### 四次挥手

TCP客户端发送一个FIN，用来关闭客户到服务器的数据传送。

服务器收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。

服务器关闭客户端的连接，发送一个FIN给客户端。

客户端发回ACK报文确认，并将确认序号设置为收到序号加1



## 相关链接

[三次握手](https://baike.baidu.com/item/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B/5111559)

[四次挥手](https://baike.baidu.com/item/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/7794287?fr=aladdin)

[知乎(作者:大闲人柴毛毛)](https://www.zhihu.com/question/24853633/answer/254224088)



